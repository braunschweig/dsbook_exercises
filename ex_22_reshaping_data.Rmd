---
title: "Ch 22 Reshaping Data"
output:
  html_document:
    df_print: paged
    number_sections: true
    toc: true
    pandoc_args: [
      "--number-sections",
      "--number-offset=22"
    ]
---



## Exercises

```{r}
library(tidyverse)
```

>1. Run the following command to define the `co2_wide` object:
>
>```{r, eval=FALSE}
>co2_wide <- data.frame(matrix(co2, ncol = 12, byrow = TRUE)) %>%
>setNames(1:12) %>%
>mutate(year = as.character(1959:1997))
>```
>
>    Use the gather function to wrangle this into a tidy dataset. Call the column with the CO2 measurements `co2` and call the month column `month`. Call the resulting object `co2_tidy`.

```{r}
str(co2)
co2_wide <- data.frame(matrix(co2, ncol = 12, byrow = TRUE)) %>% setNames(1:12) %>% mutate(year=as.character(1959:1997))
co2_tidy <- data.frame(matrix(co2, ncol = 12, byrow = TRUE)) %>% setNames(1:12) %>% mutate(year=as.factor(1959:1997)) %>% gather(key=month, value=co2, -year, convert=TRUE)
str(co2_tidy)
co2_tidy
```

>2. Plot CO2 versus month with a different curve for each year using this code:
>
>```{r, eval=FALSE}
>co2_tidy %>% ggplot(aes(month, co2, color = year)) + geom_line()
>```
>
>    If the expected plot is not made, it is probably because `co2_tidy$month` is not numeric:
>
>```{r, eval=FALSE}
>class(co2_tidy$month)
>```
>
>
>    Rewrite the call to gather using an argument that assures the month column will be numeric. Then make the plot.


```{r}
co2_tidy %>% ggplot(aes(month, co2, color = year)) + geom_line() + scale_x_continuous(breaks = c(1:12))
```

>3. What do we learn from this plot?
>
>    A. CO2 measures increase monotonically from 1959 to 1997.
>
>    B. CO2 measures are higher in the summer and the yearly average increased from 1959 to 1997.
>
>    C. CO2 measures appear constant and random variability explains the differences.
>
>    D. CO2 measures do not have a seasonal trend.

Answer A and B.
In order to see the monotonical increase of the co2 value (anwer A) and the seasonal trend over the course of each year (answer B), I've changed the class of the column year from numeric to factor, so that ggplot knows I want the lines to be connected for each year for the months.

```{r}
co2_tidy %>% filter(year==1959 | year==1969) %>% ggplot(aes(month, co2, color = year)) + geom_point() + geom_line() + scale_x_continuous(breaks = c(1:12))
```

>4. Now load the `admissions` data set, which contains admission information for men and women across six majors and keep only the admitted percentage column:
>
>```{r, eval=FALSE}
>load(admissions)
>dat <- admissions %>% select(-applicants)
>```
>
>    If we think of an observation as a major, and that each observation has two variables (men admitted percentage and women admitted percentage) then this is not tidy. Use the `spread` function to wrangle into tidy shape: one row for each major.

```{r}
library(dslabs)
data(admissions)
dat <- admissions %>% select(-applicants)
dat %>% spread(gender,admitted)
```

>5. Now we will try a more advanced wrangling challenge. We want to wrangle the admissions data so that for each major we have 4 observations: `admitted_men`, `admitted_women`, `applicants_men` and `applicants_women`.  The _trick_ we perform here is actually quite common: first gather to generate an intermediate data frame and then spread to obtain the tidy data we want. We will go step by step in this and the next two exercises.
>
>    Use the gather function to create a `tmp` data.frame with a column containing the type of observation `admitted` or `applicants`. Call the new columns `key` and value.

```{r}
tmp_gather <- admissions %>% gather(key, value, -major,-gender)
tmp_gather
```

>6. Now you have an object `tmp` with columns `major`,  `gender`, `key` and  `value`. Note that if you combine the key and gender, we get the column names we want: `admitted_men`, `admitted_women`, `applicants_men` and `applicants_women`. Use the function `unite` to create a new column called `column_name`.

```{r}
tmp_unite <- tmp_gather %>% unite(column_name, key, gender, -major, -value)
tmp_unite
```

>7. Now use the `spread` function to generate the tidy data with four variables for each major.

```{r}
tmp_unite %>% spread(column_name, value)
```

>8. Now use the pipe to write a line of code that turns `admissions` to the table  produced in the previous exercise.

```{r}
admissions %>% gather(key, value, -major,-gender) %>% unite(column_name, key, gender, -major, -value) %>% spread(column_name,value)
```


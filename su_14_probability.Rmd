---
title: "Summary 14 Probability"
output:
  html_document:
    df_print: paged
    number_sections: true
    toc: true
    pandoc_args: [
      "--number-sections",
      "--number-offset=14"
    ]
---



## Descrete Probability

>A more tangible way to think about the probability of an event is as the **proportion** of times the event occurs when we repeat the experiment an infinite number of times, independently, and under the same conditions.

Generate an urn with beads and pick a random one.
```{r}
beads <- rep(c("red", "blue"), times = c(2,3))
beads
sample(beads, 1)
```

>This line of code produces one random outcome. We want to repeat this experiment an infinite number of times, but it is impossible to repeat forever. Instead, we *repeat the experiment a large enough number of times to make the results practically equivalent to repeating forever*. This is an example of a **Monte Carlo simulation**.

```{r}
B <- 10000
events <- replicate(B, sample(beads, 1))
tab <- table(events)
tab
prop.table(tab)
```

If B gets larger the proportions get closer to 3/5=.6 and 2/5=.4.
Setting seeds to get exactly reproducable results as listed in the book.

```{r}
set.seed(1986)
events <- sample(beads, B, replace = TRUE)
prop.table(table(events))
```

Generate a deck of cards using `paste` (concatenation of strings) and `expand.grid` (generates all combinations of the elements of two vectors).

```{r}
suits <- c("Diamonds", "Clubs", "Hearts", "Spades")
numbers <- c("Ace", "Deuce", "Three", "Four", "Five", 
             "Six", "Seven", "Eight", "Nine", "Ten", 
             "Jack", "Queen", "King")
deck <- expand.grid(number=numbers, suit=suits)
deck <- paste(deck$number, deck$suit)
deck
```

Generate all possible combinations with the `permutations` function from the `gtools` package.
In how many cases is the first hand a king?
```{r}
library(gtools)
hands <- permutations(52, 2, v = deck)
first_card <- hands[,1]
second_card <- hands[,2]
kings <- paste("King", suits)
sum(first_card %in% kings)
```

What is the conditional probability that the second card is a king, when the first card is a king (3/51)?
$$
\frac{\mbox{Pr}(A \mbox{ and } B)} { \mbox{Pr}(A)}
$$
```{r}
sum(first_card %in% kings & second_card %in% kings) / sum(first_card %in% kings)
mean(first_card %in% kings & second_card %in% kings) / mean(first_card %in% kings)
```

If the order doesn't matter then we use `combinations` function.
```{r}
aces <- paste("Ace", suits)

facecard <- c("King", "Queen", "Jack", "Ten")
facecard <- expand.grid(number = facecard, suit = suits)
facecard <- paste(facecard$number, facecard$suit)

hands <- combinations(52, 2, v = deck)
mean((hands[,1] %in% aces & hands[,2] %in% facecard) | (hands[,2] %in% aces & hands[,1] %in% facecard))
# we know that the function `combinations` will list the Aces first, therefore we can leave out the second part
mean(hands[,1] %in% aces & hands[,2] %in% facecard)
```

Instead of `combinations` we can apply a Monte Carlo simulation.
```{r}
blackjack <- function(){
   hand <- sample(deck, 2)
  (hand[1] %in% aces & hand[2] %in% facecard) | 
    (hand[2] %in% aces & hand[1] %in% facecard)
}
B <- 10000
results <- replicate(B, blackjack())
mean(results)
```

Example: Monty Hall Problem
```{r}
B <- 10000
stick <- replicate(B, {
  doors <- as.character(1:3)
  prize <- sample(c("car", "goat", "goat"))
  prize_door <- doors[prize == "car"]
  my_pick  <- sample(doors, 1)
  show <- sample(doors[!doors %in% c(my_pick, prize_door)],1)
  stick <- my_pick
  stick == prize_door
})
# proportion to win the car is 1/3
mean(stick)
switch <- replicate(B, {
  doors <- as.character(1:3)
  prize <- sample(c("car", "goat", "goat"))
  prize_door <- doors[prize == "car"]
  my_pick  <- sample(doors, 1)
  show <- sample(doors[!doors %in% c(my_pick, prize_door)], 1)
  stick <- my_pick
  switch <- doors[!doors%in%c(my_pick, show)]
  switch == prize_door
})
# after revealing an option the proportion of switinng to another option is higher than sticking to the first option
mean(switch)
```

Example: Birthday problem.

Compute the proportions depending on the size of the people. First with Monte Carlo experiments and second with an exact calculation.

Then we estimate the limit of the number of Monte Carlo experiments.
```{r}
same_birthday <- function(n){
  bdays <- sample(1:365, n, replace=TRUE)
  any(duplicated(bdays))
}

B <- 10000
results <- replicate(B, same_birthday(50))
mean(results)

# estimated proportion
compute_prob <- function(n, B=10000){
  results <- replicate(B, same_birthday(n))
  mean(results)
}
# n= grop size
n <- seq(1,60)

prob <- sapply(n, compute_prob)

# exact proportion
exact_prob <- function(n){
  prob_unique <- seq(365,365-n+1)/365 
  1 - prod( prob_unique)
}

eprob <- sapply(n, exact_prob)

library(tidyverse)
qplot(n, prob) + geom_line(aes(n, eprob), col = "red")

# Estimate the convergence of the Monte Carlo experiment
# exact value is 0.569
B <- 10^seq(1, 5, len = 100)
compute_prob <- function(B, n=25){
  same_day <- replicate(B, same_birthday(n))
  mean(same_day)
}
prob <- sapply(B, compute_prob)
qplot(log10(B), prob, geom = "line")
```

```{r}
xx <- x <- 1:100
xx[x %% 3 == 0] <- "Fizz"
xx[x %% 5 == 0] <- "Buzz"
xx[x %% 15 == 0] <- "FizzBuzz"
xx
```
```{r}
#install.packages("GGally")
library(ggplot2)
library(GGally)

GGally::ggscatmat(iris, columns=1:4, color="Species") +
    scale_color_brewer(palette="Dark2") + 
    theme(legend.position="bottom")
```

